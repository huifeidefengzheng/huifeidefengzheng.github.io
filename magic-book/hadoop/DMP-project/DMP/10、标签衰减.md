#### 2.15.5.7：标签衰减

目前为止，标签的聚合操作已完毕，数据按照流程来说，可以直接落到地了；但是如果这样做，可能会造成另外一个问题的发生：

```
十年前你在上网搜索高考内容的书籍，那么2018年的今天，你还会对这些感兴趣么？

90年代，你上网搜索BB机 ， 如今你还会对这些感兴趣么？
```

因此，我们需要对历史标签数据的权重做衰减工作，如果标签长时间不再出现，那么按照衰减系数的作用，应该会变的很小，从而不会影响其他的正常标签;

##### 2.15.5.7.1：标签衰减公式

```
衰减因子计算：牛顿冷却定律数学模型：F(t)=初始温度×exp(-冷却系数×间隔的时间)
```

因此，在本项目中，标签的的的最终权重为:

```
标签最终权重=衰减因子×行为权重 + 当天权重
```

##### 2.15.5.7.2：编写标签衰减代码



```scala
//1、历史数据标签衰减
    val historyTagRdd: RDD[(String, (List[String], Map[String, Double]))] = TagAttenu.attenu(historyData)
```

```scala
package attenu

import org.apache.spark.rdd.RDD
import utils.ConfigUtils

/**
  * 标签衰减
  */
object TagAttenu {

  def attenu(historyData:RDD[(String, (List[String], Map[String, Double]))]):RDD[(String, (List[String], Map[String, Double]))]={

    historyData.map{
      case (userId,(allUserIds,tags))=>{

        val historyTags = tags.map{
          //当前标签权重 = 历史标签权重 * 衰减系数
          case (tagName,attr) => (tagName,attr * ConfigUtils.ATTENU.toDouble)
        }

        (userId,(allUserIds,historyTags))
      }
    }
  }
}

```

#### 