# SpringCloud

Q1：网站架构演变演变过程
传统架构（SSH&SSM）→分布式架构→SOA架构→微服务架构

Q2：什么是分布式架构
分布式架构是传统架构演变过来，将传统项目以模块进行拆分、分成多个子项目，每个项目都有自己独立的数据库。
分布式架构与传统架构相比，粒度更加精细、耦合度更低。

Q3：什么是SOA架构
SOA架构是分布式架构演变而来，代表面向服务架构，俗称服务化。可以理解为面向于业务逻辑层，将共同的业务代码抽取出来，提供给其他接口进行调用，服务于服务之间通讯采用RPC远程调用技术。SOA服务基于SOAP（XML+Http）

Q4：什么是微服务架构
微服务架构从SOA架构演变过来，比SOA更加精细。通过专门的模块做专门的事情，目的是为了提高效率，每个服务于服务之间互不影响、独立部署。微服务架构更加轻量级，采用RESTful（http+json）风格提供API，更加轻巧，适合互联网公司的敏捷开发、快速迭代产品。

Q5：微服务架构与SOA架构区别
微服务架构由SOA架构演变过来，有着SOA架构的优点，但在数据传输方面采用RESTful风格（http+json）进行传输
微服务架构比SOA架构更精细、更加轻量化，通过专门的模块提供特定的功能，提高了效率，每个服务独立部署、服务于服务之间互不影响
SOA架构在数据库层可能还会存在共享同一个数据库的场景，微服务架构强调每一个服务都有自己独立的数据库或者Redis，保证服务之间互不影响
因为粒度更加精细，所以微服务架构更加适合互联网公司敏捷开发、快速迭代产品。

Q6：什么是SpringCloud
SpringCloud是基于SpringBoot基础之上开发的微服务框架，SpringCloud是一套目前非常完整的微服务解决方案框架，其内容包含服务治理、注册中心、配置管理、断路器、智能路由、微代理、控制总线、全局锁、分布式会话等。

Q7：为什么要使用SpringCloud
SpringCloud是一套较完整的微服务解决框架，不像其他框架只解决了微服务中的某个问题（如Dubbo只解决了RPC调用问题，是一个RPC调用框架）

Q8：SpringCloud服务注册发现原理
在服务注册与发现中，有一个注册中心。当服务器启动的时候，会把当前自己服务器的信息比如服务地址通讯地址等以别名方式注册到注册中心上（以类似Map键值的形式进行存储，值可以是一个集群，存放时是一个list）。
另一方消费者以该别名的方式去注册中心上获取到实际的服务通讯地址，然后采用负载均衡技术在本地通过RPC远程调用实现服务与服务的通讯。

Q9：SpringCloud 支持那些注册中心
Eureka、Zookeeper、Consul
Q10：现在Eureka闭源了，可以通过什么注册中心替代Eureka呢？
Zookeeper、Consul
Q11：谈谈你对微服务服务治理的思想
在传统RPC远程调用中，服务与服务依赖关系，管理比较复杂，所以需要使用服务治理。通过管理服务与服务之间依赖关系，从而实现服务调用、负载均衡、容错等，还可以实现服务发现与注册。

Q12：如果Eureka如何实现高可用
在微服务中，注册中心非常核心，可以实现服务治理，如果一旦注册出现故障的时候，可能会导致整个微服务无法访问，在这时候就需要对注册中心实现高可用集群模式。
也就是通过相互注册的方式实现高可用，将自己作为服务向其他服务注册中心注册自己，这样就可以形成一组相互注册的服务注册中心，从而实现服务清单的互相同步，达到高可用效果。

Q13：@LoadBalanced注解的作用
如果使用rest方式以别名方式进行RPC远程调用时必须依赖Ribbon负载均衡器，通过使用@LoadBalanced注解能让这个RestTemplate在请求时拥有客户端负载均衡的能力。

Q14：Nginx与Ribbon的区别
Nginx是服务器端负载均衡，客户端请求统一交给Nginx，再由Nginx实现转发请求
Ribbon是客户端负载均衡，在调用接口时会从Eureka注册中心上获取注册服务器信息列表，获取到之后缓存再JVM本地，再使用本地RPC远程调用技术进行调用，在客户端实现动态负载均衡。

Q15：Ribbon底层实现原理
通过本地负载均衡算法：总请求数%服务器数从而获得服务器在集群list的下标，从而实现轮询的效果。

Q16：SpringCloud有几种调用接口方式
直接使用HttpClient调用
使用Rest方式调用，底层采用的是HttpClient技术
使用声明式Feign客户端调用工具，接口+注解的方式，易读性较强，实际都是采用这种方式

Q17：DiscoveryClient的作用
discoveryClient接口可以获取注册中心上的实例信息（服务列表）

Q18：服务雪崩效应产生的原因
所有的请求都在同一个线程池进行处理时，如果在高并发情况下，所有的请求全部访问同一个接口，这时候可能会导致其他服务没有线程进行接受请求，这就是服务雪崩效应。

Q19：谈谈Hystrix服务保护的原理
资源隔离：包括线程池隔离和信号量隔离，限制调用分布式服务的资源使用，某一个调用的服务出现问题不会影响其他服务调用。
降级机制：超时降级、资源不足时降级，降级后可以配合降级接口返回托底数据。
融断：当失败率达到阀值自动触发降级，熔断器触发的快速失败会进行快速恢复。
缓存：提供了请求缓存、请求合并实现。

Q20：谈谈服务降级、熔断、服务隔离
服务降级：在高并发情况下，为了防止用户一直等待，使用服务降级方式，直接返回一个友好的提示给客户端（通常是设置fallback方法，不会去处理请求）
服务熔断：在高并发情况下，如果达到了请求的阈值，自动开启服务保护机制、拒绝新的访问，使用服务降级返回友好提示（熔断与降级一起使用）
服务隔离：对核心高并发接口设置独立的线程池，每个线程池互不影响

Q21：服务降级底层是如何实现的？
通过设置fallback方法，当接口相应超时时，直接返回对应的callback方法的逻辑，返回给用户一个友好的提示

Q22：分布式配置中心有那些框架？
Apollo、SpringCloud Config、Zookeeper（持久节点+事件通知）

Q23：分布式配置中心的作用？
把服务相关的配置文件统一存放在分布式配置中心中，当服务正在运行的时候，如果配置文件需要发生改变，可以实现不需要重启服务器而实时更改配置文件信息。

Q24：springcloud config 可以实现实时刷新吗？
可以，采用SpringCloud Bus消息总线可以实现实时刷新
Q25：什么是网关?
客户端请求统一先到网关服务器，再由网关服务器进行转发到实际服务器，类似Nginx

Q26：网关的作用是什么
网关可以拦截客户端的所有请求，进而实现负载均衡、路由转发、日志、权限控制、监控、黑名单白名单等功能。
Q27：网关与过滤器有什么区别
网关是拦截所有服务器请求进行控制
过滤器拦截某单个服务器请求进行控制

Q28：常用网关框架有那些？
Kong kong是基于Nginx+Lua进行二次开发的一个框架
Netflix Zuul，是spring cloud的一个推荐组件
Orange，由国人开发

Q29：Zuul与Nginx有什么区别？
Zuul使用Java编写，依赖Ribbon和Eureka实现本地负载均衡，Nginx使用C编写，实现服务器端负载均衡
相对来说Nginx功能比Zuul功能更加强大，能够整合其他语言比如lua脚本实现强大的功能，同时Nginx可以更好的抗高并发
Zuul网关适用于请求过滤和拦截等

Q30：既然Nginx可以实现网关？为什么还需要使用Zuul框架
Nginx是使用C语言编写，而Zuul是使用Java语言编写。这就导致在Java环境下，Zuul的扩展性更强，所以一般都是采用Nginx实现反向代理再加上Zuul实现网关拦截、负载均衡

Q31：如何设计一套API接口
需要考虑接口权限问题（是暴露给公网的开放接口还是内网使用的内部接口）、幂等性问题、安全性问题（https协议）
使用网关拦截接口实现黑名单和白名单
接口使用RESTful风格（http+json）轻量级并且可以跨平台
考虑并发性，对接口服务进行保护（服务的降级、熔断、隔离）
同时还可以使用统一的API管理平台，如Swagger2

Q32：ZuulFilter常用有那些方法
run：过滤器的具体逻辑
shouldFilter：判断过滤器是否生效
filterOrder：过滤器执行顺序
filterType：过滤器类型
pre：可以在请求之前调用
route：在请求时候被调用
post：在route和error过滤器之后被调用
error：处理请求时发生错误时被调用

Q33：如何实现动态Zuul网关路由转发
整合分布式配置中心（SpringCloud Config或者Apollo），实现动态路由转发

Q34：Zuul网关如何搭建集群
通过Nginx+Zuul，客户端发送请求到Nginx上，再使用Nginx的反向代理和负载均衡，采用轮询算法转发到网关Zuul上
