# elasticsearch

Q1：为什么要使用elasticsearch框架
ElasticSearch能够扩展至数以百计的服务器以及处理PB级（1PB=1024TB）的数据，他可以在很短的时间内存储、搜索和分析大量的数据。
他的高横向拓展性使得我们在增加服务器时只需要做一点配置然后启动就可以直接并入集群
他的分片机制提供了更好的分布性，同一个索引（Index）被分成了多个分片（shard），类似于大数据处理HDFS的块机制、分而治之，可以提升处理效率
他还提供了复制（replica）机制实现了高可用性，一个主分片可以设置多个备份，使得某台服务器在宕机的情况下，集群仍旧可以照常运行（并且不需要像redis那样特地去配置哨兵机制、选举策略、主从同步和读写分离，这些都已经被集成了），并会把服务器宕机丢失的数据信息复制回复到其他可用节点上

Q2：elasticsearch应用场景
ElasticSearch（存储日志）可以结合Logstash（收集日志）和Kibana（查看日志）构建大型分布式日志分析系统，还可以构建大型电商商品搜索系统、网站的站内搜索功能以及网盘搜索引擎等

Q3：elasticsearch存储结构
ElasticSearch是文件存储、面向文档型的数据库，一条数据就是一个文档，使用JSON作为文档序列化的格式
其中索引（Index）的概念对应关系型数据库如MySQL中的数据库（schema），类型（Type）对应表（table）、文档（Document）对应行（line）、字段（Field）对应列字段（column）

Q4：什么是KIBana
Kibana是一个开源的分析和可视化平台，用于和ElasticSearch一起工作
我们可以使用Kibana来搜索、查看，并和存储在ElasticSearch的索引中的数据进行交互
我们可以轻松地执行高级数据分析，并且可以使用图表、表格和地图的形式对数据进行可视化处理
使用Kibana使得理解大量数据变得容易，它简单的、基于浏览器的界面使得我们能够快速创建和共享动态仪表板，实时显示ElasticSearch查询的变化

Q5：elasticsearch是如何控制高并发
ElasticSearch内部使用CAS无锁原理基于_version进行乐观锁并发控制：_version自增长，修改数据后，它会自动加一，从而保证了数据在多线程操作下的准确性，这种模式称为内部版本控制
同时还有一种外部版本控制，使用version_type=external检查数据当前的_version值是否小于请求中的version值，从而保证内部_version与外部版本版本控制的数值一致

Q6：9200端口与9300端口区别
9200是暴露给外界的、RESTful风接口的端口号，供ES节点和外部通讯使用（http），Kibana就是通过9200端口进行数据查询的
9300是ES集群之间通讯的端口号（tcp），供ES节点之间进行通讯（整合SpringBoot时使用的就是这个端口号）

Q7：elasticsearch倒排索引原理
倒排索引利用分词的原理以字或者词为关键字进行索引，表中的关键字所对应的记录表项记录了出现这个字或者词的所有文档，一个表项就是一个表字段，它记录该文档的ID和字符在该文档中出现的位置情况
由于每个字或者词对应的文档数量是动态变化的，所以倒排表的建立和维护都比较复杂；但相对的在查询时由于可以一次得到查询关键字所对应的所有文档，所以查询效率非常高
在全文检索中，检索的快速响应是一个最为关键的性能，而索引建立由于在后台进行，尽管建立和修改的效率相对较低，但带来了高效的查询效率，因此不会影响整个搜索引擎的效率

Q8：term查询与match查询的区别
Term查询是精确匹配查询，不会对字段进行分词查询，类似MySQL的“=”
Match是模糊查询，会利用分词器对查询字段进行分词查询，一定程度上类似MySQL的“like”

Q9：谈谈中文分词器IK插件
因为ElasticSearch默认的标准分词器对中文分词不是很友好，会将中文词语拆分成一个个中文汉字，因此引入了中文分词器ES-IK插件
注意：插件的版本一定要和ES的版本一致，而不是传统的高版本兼容低版本的模式

Q10：Elasticsearch是如何实现集群的？
1.每个索引都会被分成多个分片（shard）进行存储，默认常见索引时分配5个分片进行存储。每个分片都会分布式部署在多个不同的节点上，这5个分片也称为主分片primary shards
并且索引的主分片定义好之后，不能更改，因为采用取余算法，修改后后续查询时会出问题
2.每一个主分片为了实现高可用，都会有自己对应的备份分片（至少一个），并且主分片和对应的备份分片不能存放在同一台服务器上，但可以和其他主分片的本分分片放在同一台服务器上（备份分片的数量可以修改）
因此，如果只部署一台服务器，其中是没有备份分片的

Q11：主分片数量与副分片数量区别
每个主分片可以有一个或者多个副分片；
建议总分片的个数是节点的平方，即每个主分片拥有节点个数-1个副分片

Q12：为什么ES索引主分片数量不能改
ElasticSearch采用数据路由（document routing）原理，当客户端发起创建document的时候，ElasticSearch需要确定该document存放在index的哪个shard上。
路由算法：shard = hash（ID）%number_of_primary_shards
如果总主分片数发生变化，在进行查询是取余的数据就不对应，因此无法获取到指定数据（因为自身特性的原因，不能实现类似HashMap的扩容机制）

Q13：elasticsearch与solr对比
Solr利用Zookeeper进行分布式管理，而Elasticsearch自身带有分布式协调管理功能；
Solr支持更多格式的数据如：HTML、PDF、微软Office系列软件格式以及JSON、XML、CSV 等纯文本格式，而Elasticsearch仅支持JSON文件格式；
Solr官方提供的功能更多，而Elasticsearch本身更注重于核心功能，高级功能多有第三方插件提供（如一般不用ES自带的中文分词器，而采用中文分词器IK插件）；
Solr在传统的搜索应用中表现好于Elasticsearch，但在处理实时搜索应用时效率明显低于Elasticsearch；Solr是传统搜索应用的有力解决方案，但Elasticsearch更适用于新兴的实时搜索应用；
当单纯的对已有数据进行搜索时Solr更快；而当实时建立索引时，Solr会产生IO阻塞，查询性能较差，这种场景下Elasticsearch具有明显的优势，所以Solr的架构不适合实时搜索的应用；
随着数据量的增加，Solr的搜索效率会变得更低；而Elasticsearch却没有明显的变化。

Q14：分布式日志收集如何实现？
采用ELK（ElasticSearch+Logstash+Kibana）构建大型分布式日志收集系统
1.每台服务器集群节点安装Logstash日志收集系统插件，它会将本地文件的日志输入到Logstash中
2.Logstash获取本地日志文件后，根据日期创建不同的索引，以JSON格式输出到ElasticSearch服务器中进行存放
3.浏览器使用安装的Kibana图形化界面展示ElasticSearch数据

Q15：elk分别指的是？
见Q14
